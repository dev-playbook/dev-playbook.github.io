---
title: 'Azure WebApp and GitHub'
index: 20
layout: post
date: 2020-11-17 16:29
categories: 
    - Azure CLI
    - Azure WebApps
permalink: azure-cli/webapps/github
tags:
    - devops
    - git
    - continuous deployment
    - github
description: This tutorial takes the introduction to Azure Web Apps further by showing how to manually deploy changes from a public repository in GitHub, and switch over to continuous deployment with GitHub.
---

>tl;dr
>```shell
># configure source deployment to the main branch of a remote repository
>az webapp deployment source config -n {app name} -g {group name} \
        --repo-url {git repo url} \ 
        --branch {git branch name} \
        --manual-integration
>
># deploy source changes in remote repository
>az webapp deployment source sync -n {app name} -g {group name}
>```

## **Introduction**

{{page.description}}
{%include az-cli/000-prerequisites.md%}
- A GitHub account
- git cli installed

## **Prepare**
{%include az-cli/005-login-account.md%}
{% include az-cli/010-create-resource-group.md %}

## **Create Web App**

{% include az-cli/020-create-app-service.md sku="F1"%}

{% include az-cli/030-create-webapp-nodejs.md%}

{% include az-cli/040-browse-webapp.md %}

    Expect to see a placeholder page for NodeJS apps.

## **Deploy Source**

1. **[Fork](https://docs.github.com/en/free-pro-team@latest/github/getting-started-with-github/fork-a-repo)** this repository to your own GitHub account.

    ```
    https://github.com/dev-playbook/nodejs-env-request-vars
    ```

    The source code contains a small NodeJs application. 

1. Configure the source of the deployment to the _main_ branch of your GitHub repository.

    ```shell
    repourl="https://github.com/{your-git-username}/nodejs-env-request-vars.git"
    az webapp deployment source config --repo-url $repourl --branch main --manual-integration --verbose
    ```
    
    The results should include details of the deployment source, including the value of <code>repourl</code> as the repository Url and <code>main</code> as the branch name.

    The <code>--manual-integration</code> infers no continuous integration and deployment of source changes.

1. Confirm the deployment was successful.

    ```shell
    az webapp browse
    ```
    Expect the results to include a '_Hello World from Version 1_' header and a list of key-value pairs from the environment variables and the HTTP request.

## **Manual Deployment of Source Changes**

1. Execute the following from a working folder to change the header message of the NodeJS app.

    ```shell
    # clone github repository
    git clone https://github.com/{your-git-username}/nodejs-env-request-vars.git
    cd ./nodejs-env-request-vars

    # change message to Version 2
    (cat ./app.js) | sed -e 's/Version ./Version 2/g' > app.js

    # commit changes
    git add ./app.js
    git commit -m 'updated to Version 2'
    git push
    ```

    > Alternatively, you can make the changes [directly from GitHub](https://docs.github.com/en/free-pro-team@latest/github/managing-files-in-a-repository/editing-files-in-your-repository).

1. Deploy source changes.

    ```shell
    az webapp deployment source sync --verbose
    ```

    Note that you may have to wait for a couple of minutes for the deployment to complete.

1. Confirm the deployment of the source changes was successful.

    ```shell
    az webapp browse
    ```
    Expect the results to include a header message **'Hello World from Version 2'**.

{% include az-cli/060-view-deployment-logs.md %}
    Expect to see 2 log entries, one per deployment. The last deployment is flagged as _active_ and refers to the latest.

## **Continuous Deployment**

1. From the cloned repository folder, execute the following to change the header message of the NodeJS app to Version 3.

    ```shell
    # change message to Version 3
    (cat ./app.js) | sed -e 's/Version ./Version 3/g' > app.js

    # commit changes
    git add ./app.js
    git commit -m 'updated to Version 3'
    git push
    ```

1. From your GitHub account, [obtain a personal access token](https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token){:target="_blank"} with ONLY the following permissions granted.

    ```
    write:repo_hook
    read:repo_hook
    ```

1. Update the deployment source config to use a git token

    ```shell
    az webapp deployment source delete --verbose

    az webapp deployment source config --repo-url $repourl --branch main --git-token {personal access token} --verbose
    ```

    Note that deleting the previous configuration is necessary in order to remove <code>--manual-integration</code>. Consequently, previous deployment logs will be lost.

1. Confirm the deployment of the source changes was successful.

    ```shell
    az webapp browse
    ```
    Expect the results to include a header message **'Hello World from Version 3'**.

1. From the cloned repository folder, execute the following to change the header message of the NodeJS app to Version 4.

    ```shell
    # change message to Version 3 from Version 1
    (cat ./app.js) | sed -e 's/Version ./Version 4/g' > app.js

    # commit changes
    git add ./app.js
    git commit -m 'updated to Version 4'
    git push
    ```

1. Await for a couple of minutes, then confirm the automated deployment of the source change was successful.

    ```shell
    az webapp browse
    ```
    Expect the results to include a header message **'Hello World from Version 4'**.

{% include az-cli/060-view-deployment-logs.md %}
    Expect to see 2 log entries, one per deployment. Note that log entries under <code>--manual-integration</code> are not included as they were lost from the config changes. The last deployment is flagged as _active_ and refers to the latest source change.

## **Clean up**

{% include az-cli/999-cleanup.md%}
1. You may also want to revoke the personal access token from GitHub.

## **Further Reading**

- [GitHub Actions: Continuous Delivery with Azure](https://lab.github.com/githubtraining/github-actions:-continuous-delivery-with-azure){:target="_blank"}
