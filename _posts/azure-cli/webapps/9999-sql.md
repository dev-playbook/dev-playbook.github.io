---
title: Azure Web App with SQL Connectivity
index: 10
layout: post
date: 2020-12-03 12:00
categories: 
    - Azure CLI
    - Azure WebApps
permalink: azure-cli/webapps/sql
tags:
    - devops
    - sql
description: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi consectetur diam justo, quis viverra turpis rutrum ut. Praesent sodales sapien vel est venenatis, non luctus purus aliquam. Morbi euismod mattis erat et finibus. Sed ac purus sit amet orci convallis dictum. Sed euismod quis ipsum non porta. 
---

## **Introduction**

{{page.description}}
{%include az-cli/000-prerequisites.md%}

## **Prepare**

1. Complete either the _[introductory]({% link _posts/azure-cli/webapps/2020-11-15-introduction.md %})_ or _[GitHub deployment]({% link _posts/azure-cli/webapps/2020-11-17-github.md %})_ tutorial excluding Clean Up.

1. Confirm the NodeJS app is deployed and running.
    ```shell
    az webapp browse
    ```

1. Confirm the default arguments to `az` command for _group_ and _web_ are configured.
    ```shell
    az configure --list-defaults --output table
    ```

1. Ensure that variable $appname has the value of the web app's name.

    ```shell
    [[ -z "$appname" ]] && appname=$(az webapp show --query "name" --output tsv | sed -E "s/\r//g")
    echo $appname
    ```


#/bin/bash

# Variables
appName="webappwithSQL$RANDOM"
serverName="webappwithsql$RANDOM"
location="WestUS"
startip="0.0.0.0"
endip="0.0.0.0"
username="<replace-with-username>"
sqlServerPassword="<replace-with-password>"

# Create a resource group 
az group create --name myResourceGroup --location $location

# Create an App Service plan
az appservice plan create --name myAppServicePlan --resource-group myResourceGroup \
--location $location

# Create a web app
az webapp create --name $appName --plan myAppServicePlan --resource-group myResourceGroup

# Create a SQL Database server
az sql server create --name $serverName --resource-group myResourceGroup \
--location $location --admin-user $username --admin-password $sqlServerPassword

# Configure firewall for Azure access
az sql server firewall-rule create --server $serverName --resource-group myResourceGroup \
--name AllowYourIp --start-ip-address $startip --end-ip-address $endip

# Create a database called 'MySampleDatabase' on server
az sql db create --server $serverName --resource-group myResourceGroup --name MySampleDatabase \
--service-objective S0

# Get connection string for the database
connstring=$(az sql db show-connection-string --name MySampleDatabase --server $serverName \
--client ado.net --output tsv)

# Add credentials to connection string
connstring=${connstring//<username>/$username}
connstring=${connstring//<password>/$sqlServerPassword}

# Assign the connection string to an app setting in the web app
az webapp config appsettings set --name $appName --resource-group myResourceGroup \
--settings "SQLSRV_CONNSTR=$connstring" 